let currentLink = '';

function validateDriveLink(link) {
    const regex = /^(https?:\/\/)?(www\.)?(drive\.google\.com)\/.*?\/d\/([^\/]+)/;
    return regex.test(link);
}

function encodeUrl() {
    const affiliateLink = document.getElementById('affiliateLink').value.trim();
    const driveLink = document.getElementById('driveLink').value.trim();

    // Validasi input kosong
    if (!affiliateLink || !driveLink) {
        alert('Silakan masukkan semua link!');
        return;
    }

    // Validasi format link Google Drive
    if (!validateDriveLink(driveLink)) {
        alert('Silakan masukkan link Google Drive yang valid! Contoh: https://drive.google.com/file/d/ID_FILE/view');
        return;
    }

    try {
        const encodedAffiliateLink = encodeURIComponent(affiliateLink);
        const driveId = new URL(driveLink).pathname.split('/')[3]; // Mengambil ID file dari link
        
        // Pastikan driveId ada
        if (!driveId) {
            throw new Error('ID file tidak ditemukan di link Google Drive.');
        }

        currentLink = `https://san-martin-aff.github.io?vid=${driveId}&aff=${encodedAffiliateLink}`;
        
        document.getElementById('encodedOutput').innerText = `Link Lengkap: ${currentLink}`;
        document.getElementById('copyButton').style.display = 'inline-block';
        document.getElementById('reviewButton').style.display = 'inline-block';
    } catch (error) {
        alert('Terjadi kesalahan: ' + error.message);
    }
}

function copyLink() {
    navigator.clipboard.writeText(currentLink).then(() => {
        alert('Link telah disalin ke clipboard!');
    }).catch(err => {
        alert('Gagal menyalin link: ' + err);
    });
}

function reviewLink() {
    window.open(currentLink, '_blank'); // Buka link di tab baru
}
